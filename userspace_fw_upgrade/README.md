### Vulnerability
- In tplink deco firmware, tplink provides a web-ui based firmware update mechanism
that accepts manually specified firmware images
- This code also has unconstrained sscanf reading the "fw-type" field
from the user-provided firmware file into a fixed 256-byte stack buffer

### Exploit
- Take control of PC by overflowing stack buffer enough to overwrite return address
- Point return address into range where kernel could mmap a 16MB file
- Spray the firmware file with shellcode to catch whichever region KASLR selects

### Shellcode
- [bind shell from metasploit](https://github.com/rapid7/metasploit-framework/blob/master/modules/payloads/singles/linux/mipsbe/shell_bind_tcp.rb)

### Possible Applicable Devices
- Many TP-Link Deco devices

### Devices With Confirmed Working Exploit
- [Deco S4 v2 firmware 1.6.1](https://github.com/naf419/tplink_deco_exploits/releases/download/v3/deco_fw_overflow_bindshell_mips.bin)
- [Deco X20 v3 firmware 1.1.8](https://github.com/naf419/tplink_deco_exploits/releases/download/v3/deco_fw_overflow_bindshell_mipsel.bin)

### Building
```
python build_fw_mips.py > deco_fw_overflow_bindshell_mips.bin
python build_fw_mipsel.py > deco_fw_overflow_bindshell_mipsel.bin
```
